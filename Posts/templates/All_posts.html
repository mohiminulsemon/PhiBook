{% for post in posts %}
  <div class="post">
    <h2>{{ post.title }}</h2>
    <p>{{ post.content }}</p>
    {% if post.image %}
      <img class="w-20 h-20" src="{{ post.image.url }}" alt="{{ post.title }}">
    {% endif %}

        <!-- Like/Unlike button and likes count -->
        <form method="post" action="{% url 'like_post' post.id %}">
            {% csrf_token %}
            {% if request.user in post.likes.all %}
              <button type="submit" name="action" value="unlike">Unlike</button>
            {% else %}
              <button type="submit" name="action" value="like">Like</button>
            {% endif %}
          </form>
          <p>Likes: {{ post.likes.count }}</p>
          
    <!-- Display comments for this post -->
    <h3>Comments:</h3>
    {% for comment in comments %}
      {% if comment.post == post %}
        <p>{{ comment.user.username }}: {{ comment.text }}</p>
      {% endif %}
    {% endfor %}

    <!-- Comment form for this post -->
    <form method="post" action="{% url 'post_list' %}">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <input type="hidden" name="post_id" value="{{ post.id }}">
      <button type="submit">Add Comment</button>
    </form>
  </div>
{% endfor %}
